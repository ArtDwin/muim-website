<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ... (same head as your current file, leave everything as is) ... -->
  <!-- (keep all your styles, header, hero, features, coin, footer, etc) -->
  <!-- ... your CSS and HTML above ... -->
</head>
<body>
  <!-- ... your full original body content ... -->

  <script>
    // -------------- Section toggles --------------
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
      if (id === 'home') {
        document.getElementById('home-section').scrollIntoView({ behavior: 'smooth' });
      } else if (id === 'features') {
        document.getElementById('features-section').classList.add('active');
        document.getElementById('features-section').scrollIntoView({ behavior: 'smooth' });
      }
    }

    // -------------- Wallet / SPEC stubs --------------
    function connectWallet() {
      alert('üîê Wallet connection coming soon!');
      document.getElementById('walletStatus').innerText = 'üü¢ Wallet Connected';
    }
    function startSpec() {
      alert('üöÄ SPEC Trading launch coming soon!');
    }

    // -------------- Chat overlay control --------------
    const overlay = document.getElementById('chatOverlay');
    function openChat() {
      overlay.classList.add('active');
      initChat();
    }
    function closeChat() {
      overlay.classList.remove('active');
    }

    // -------------- Chat logic with HEMOS (fallback) --------------
    let isTyping = false;
    async function fetchWithFallback(urls, options) {
      for (const url of urls) {
        try {
          const res = await fetch(url, options);
          if (res.ok) return res;
        } catch (e) {}
      }
      throw new Error('All endpoints failed');
    }

    function addMessage(text, sender = 'ai') {
      const container = document.getElementById('chatMessages');
      const msg = document.createElement('div');
      msg.className = `message ${sender}`;
      const avatar = document.createElement('div');
      avatar.className = 'message-avatar ' + sender;
      avatar.innerText = sender === 'user' ? 'üë§' : 'üß†';
      const content = document.createElement('div');
      content.className = 'message-content';
      content.innerText = text;
      msg.appendChild(avatar);
      msg.appendChild(content);
      container.appendChild(msg);
      container.scrollTop = container.scrollHeight;
    }

    function addTyping() {
      const container = document.getElementById('chatMessages');
      const indicator = document.createElement('div');
      indicator.id = 'typingIndicator';
      indicator.className = 'typing-indicator';
      indicator.innerHTML = '<div class="typing-dots"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div></div>';
      container.appendChild(indicator);
      container.scrollTop = container.scrollHeight;
    }
    function removeTyping() {
      const ind = document.getElementById('typingIndicator');
      if (ind) ind.remove();
    }

    async function sendChat() {
      if (isTyping) return;
      const input = document.getElementById('chatInput');
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, 'user');
      input.value = '';
      addTyping();
      isTyping = true;

      // Both URLs: local Flask first, then cloud
      const urls = [
        'http://192.168.1.12:7070/ask',   // Local/LAN Flask
        'https://muim-website.onrender.com/ask' // Cloud Render
      ];
      const options = {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ question: text })
      };

      try {
        const res = await fetchWithFallback(urls, options);
        const data = await res.json();
        removeTyping();
        addMessage(data.answer || 'No reply.', 'ai');
      } catch (e) {
        removeTyping();
        addMessage('‚ö†Ô∏è Error contacting Oracle.', 'ai');
      } finally {
        isTyping = false;
      }
    }

    function initChat() {
      document.getElementById('chatMessages').innerHTML = '';
      addMessage('Welcome to MUIM Quantum Oracle!', 'ai');
    }

    document.getElementById('chatSend').onclick = sendChat;
    document.getElementById('chatInput').addEventListener('keydown', e => {
      if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendChat(); }
    });
  </script>
</body>
</html>